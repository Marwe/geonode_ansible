---
- name: Service | Copy geonode.binary
  become: yes
  shell: "cp {{ virtualenv_dir }}/src/geonode/package/support/geonode.binary /usr/bin/geonode"

- name: Service | Copy geonode.updateip
  become: yes
  shell: "cp {{ virtualenv_dir }}/src/geonode/package/support/geonode.updateip /usr/bin/geonode_updateip"
 
- name: Service | Make executable geonode
  become: yes
  shell: "chmod +x /usr/bin/geonode"

- name: Service | Make executable geonode_updateip
  become: yes
  shell: "chmod +x /usr/bin/geonode_updateip"

- file:
    src: "{{ virtualenv_dir }}/bin/django-admin.py"
    dest: /usr/local/bin/django-admin
    owner: "{{ user }}"
    state: link
  become: yes

- name: Service | Run geonode_updateip
  become: yes
  shell: ". {{ virtualenv_dir }}/bin/activate && geonode_updateip -p {{ server_name }}"
  environment:
    DJANGO_SETTINGS_MODULE: "{{ project_name }}.local_settings"
    GEONODE_ETC: "{{ project_path }}/{{ project_name }}"
    GEOSERVER_DATA_DIR: /data/geoserver-data


